{% extends "base.html" %}

{% block title %}–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã - –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞{% endblock %}

{% block head %}
<style>
    .settings-container {
        background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        border-radius: 24px;
        padding: 2rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(130, 0, 0, 0.1);
    }

    .settings-card {
        background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
        border-radius: 20px;
        padding: 28px;
        border: 2px solid transparent;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        margin-bottom: 24px;
    }

    .settings-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(130, 0, 0, 0.05), transparent);
        transition: left 0.6s ease;
    }

    .settings-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 32px rgba(130, 0, 0, 0.12);
        border-color: rgba(130, 0, 0, 0.2);
    }

    .settings-card:hover::before {
        left: 100%;
    }

    .setting-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 0;
        border-bottom: 1px solid #f1f5f9;
    }

    .setting-item:last-child {
        border-bottom: none;
    }

    .setting-label {
        font-weight: 600;
        color: #1f2937;
    }

    .setting-description {
        font-size: 0.875rem;
        color: #6b7280;
        margin-top: 4px;
    }

    .toggle-switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 34px;
    }

    .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 34px;
    }

    .slider:before {
        position: absolute;
        content: "";
        height: 26px;
        width: 26px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
    }

    input:checked + .slider {
        background-color: #820000;
    }

    input:checked + .slider:before {
        transform: translateX(26px);
    }

    .btn-save {
        background: linear-gradient(135deg, #820000 0%, #a91b2b 100%);
        color: white;
        padding: 12px 32px;
        border-radius: 16px;
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 4px 15px rgba(130, 0, 0, 0.3);
        border: none;
        cursor: pointer;
    }

    .btn-save:hover {
        transform: translateY(-3px) scale(1.05);
        box-shadow: 0 8px 25px rgba(130, 0, 0, 0.4);
    }

    .stats-overview {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 32px;
    }

    .stat-box {
        background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
        border-radius: 16px;
        padding: 24px;
        text-align: center;
        border: 1px solid #e2e8f0;
        transition: all 0.3s ease;
    }

    .stat-box:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    }

    .stat-value {
        font-size: 2rem;
        font-weight: 900;
        color: #820000;
        margin-bottom: 8px;
    }

    .stat-label {
        color: #6b7280;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        font-size: 0.875rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="mb-6">
    <a href="{{ url_for('admin_olympiads') }}" class="inline-flex items-center text-[#820000] hover:text-[#990002] transition-all duration-300 transform hover:scale-105">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
        </svg>
        –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø–∞–Ω–µ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    </a>
</div>

<div class="settings-container">
    <h1 class="text-3xl font-bold mb-8 text-gray-800">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</h1>

    <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="stats-overview">
        <div class="stat-box">
            <div class="stat-value" id="total-olympiads">{{ stats.total_olympiads or 0 }}</div>
            <div class="stat-label">–í—Å–µ–≥–æ –æ–ª–∏–º–ø–∏–∞–¥</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="total-users">{{ stats.total_users or 0 }}</div>
            <div class="stat-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="total-participations">{{ stats.total_participations or 0 }}</div>
            <div class="stat-label">–£—á–∞—Å—Ç–∏–π</div>
        </div>
        <div class="stat-box">
            <div class="stat-value">{{ now().strftime('%d.%m.%Y') }}</div>
            <div class="stat-label">–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞</div>
        </div>
    </div>

    <!-- –°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
    <div class="settings-card">
        <h2 class="text-2xl font-bold mb-6 text-gray-800">üîß –°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h2>

        <form id="settings-form">
            <div class="setting-item">
                <div>
                    <div class="setting-label">–†–∞–∑—Ä–µ—à–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                    <div class="setting-description">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–º–æ–≥—É—Ç —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç—ã</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" name="allow_registration" checked>
                    <span class="slider"></span>
                </label>
            </div>

            <div class="setting-item">
                <div>
                    <div class="setting-label">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ–ª–∏–º–ø–∏–∞–¥</div>
                    <div class="setting-description">–û–ª–∏–º–ø–∏–∞–¥—ã –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≤–µ—Ä—à–∞—Ç—å—Å—è –ø–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" name="auto_finish" checked>
                    <span class="slider"></span>
                </label>
            </div>

            <div class="setting-item">
                <div>
                    <div class="setting-label">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ email</div>
                    <div class="setting-description">–û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞–º –æ –Ω–∞—á–∞–ª–µ –æ–ª–∏–º–ø–∏–∞–¥</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" name="email_notifications">
                    <span class="slider"></span>
                </label>
            </div>

            <div class="setting-item">
                <div>
                    <div class="setting-label">–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</div>
                    <div class="setting-description">–£—á–∞—Å—Ç–Ω–∏–∫–∏ —Å–º–æ–≥—É—Ç –≤–∏–¥–µ—Ç—å —Å–≤–æ–π —Ä–µ–π—Ç–∏–Ω–≥ –≤–æ –≤—Ä–µ–º—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" name="realtime_ranking" checked>
                    <span class="slider"></span>
                </label>
            </div>
        </form>
    </div>

    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ -->
    <div class="settings-card">
        <h2 class="text-2xl font-bold mb-6 text-gray-800">üîí –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</h2>

        <div class="setting-item">
            <div>
                <div class="setting-label">–ê–Ω–æ–Ω–∏–º–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</div>
                <div class="setting-description">–°–∫—Ä—ã–≤–∞—Ç—å –∏–º–µ–Ω–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤ –æ–±—â–∏—Ö —Ä–µ–π—Ç–∏–Ω–≥–∞—Ö</div>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" name="anonymous_results">
                <span class="slider"></span>
            </label>
        </div>

        <div class="setting-item">
            <div>
                <div class="setting-label">–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–≥–æ–≤</div>
                <div class="setting-description">–í–µ–¥–µ–Ω–∏–µ –∂—É—Ä–Ω–∞–ª–∞ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" name="keep_logs" checked>
                <span class="slider"></span>
            </label>
        </div>
    </div>

    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–ª–∏–º–ø–∏–∞–¥ -->
    <div class="settings-card">
        <h2 class="text-2xl font-bold mb-6 text-gray-800">üìö –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–ª–∏–º–ø–∏–∞–¥</h2>

        <div class="setting-item">
            <div>
                <div class="setting-label">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞ –æ–ª–∏–º–ø–∏–∞–¥—É (—á–∞—Å—ã)</div>
                <div class="setting-description">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è, –æ—Ç–≤–µ–¥–µ–Ω–Ω–æ–µ –Ω–∞ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –æ–ª–∏–º–ø–∏–∞–¥—ã</div>
            </div>
            <input type="number" name="max_olympiad_hours" value="3" min="1" max="24" class="w-20 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-primary">
        </div>

        <div class="setting-item">
            <div>
                <div class="setting-label">–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏</div>
                <div class="setting-description">–†–∞–∑—Ä–µ—à–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞–º –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –æ–ª–∏–º–ø–∏–∞–¥</div>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" name="allow_retries">
                <span class="slider"></span>
            </label>
        </div>

        <div class="setting-item">
            <div>
                <div class="setting-label">–ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å—Ä–∞–∑—É</div>
                <div class="setting-description">–û—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —É—á–∞—Å—Ç–Ω–∏–∫–∞–º —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è</div>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" name="instant_results" checked>
                <span class="slider"></span>
            </label>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
    <div class="flex justify-between items-center mt-8">
        <div>
            <button onclick="exportSystemData()" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
                –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
            </button>
        </div>
        <button onclick="saveSettings()" class="btn-save">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                <path d="M7.707 10.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V6h5a2 2 0 012 2v7a2 2 0 01-2 2H4a2 2 0 01-2-2V8a2 2 0 012-2h5v5.586l-1.293-1.293zM9 4a1 1 0 012 0v2H9V4z" />
            </svg>
            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        </button>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function saveSettings() {
        const form = document.getElementById('settings-form');
        const formData = new FormData(form);

        // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        const settings = {};
        const checkboxes = form.querySelectorAll('input[type="checkbox"]');
        const inputs = form.querySelectorAll('input[type="number"]');

        checkboxes.forEach(checkbox => {
            settings[checkbox.name] = checkbox.checked;
        });

        inputs.forEach(input => {
            settings[input.name] = input.value;
        });

        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        console.log('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', settings);

        // –ò–º–∏—Ç–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        showMessage('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!', 'success');
    }

    function exportSystemData() {
        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —ç–∫—Å–ø–æ—Ä—Ç —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        showMessage('–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è...', 'info');

        // –ò–º–∏—Ç–∞—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞
        setTimeout(() => {
            const link = document.createElement('a');
            link.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent('System data export - ' + new Date().toISOString());
            link.download = 'system_data_' + new Date().toISOString().split('T')[0] + '.txt';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showMessage('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!', 'success');
        }, 2000);
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', function() {
        loadSystemStats();
    });

    function loadSystemStats() {
        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å —Å–µ—Ä–≤–µ—Ä–∞
        // –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ —à–∞–±–ª–æ–Ω–∞
    }
</script>
{% endblock %}